网易云音乐版本：2.5.2

由于网易云音乐是x86版本，所以JNI需使用x86编译成dll，并使用x86版本的jdk来运行。

| 版本 | 功能                     | 时间      |
| ---- | ------------------------ | --------- |
| 1.0  | 获取当前歌曲进度,title | 2021/1/31 |
| 1.1  | 获取当前歌曲进度,title和歌词 | 2021/1/31 |
| 1.2  | 代码重构 | 2021/2/1 |

# 有关偏移地址0x8669C8的得出方式
***以2.5.2版本网易云音乐为例***

使用CE修改器监视当前歌曲播放的时间（网易云音乐内播放时间是double类型），得出绝对地址`0x6E5869C8`。

![](https://i.niupic.com/images/2021/01/31/9aCE.png)

接着点击“找出是什么改写了该地址”，点击网易云播放，后暂停，找到相关代码，点击“显示反汇编程序”：

![](https://i.niupic.com/images/2021/01/31/9aDj.png)

![](https://i.niupic.com/images/2021/01/31/9aDm.png)

从上图可得出基址为`cloudmusic.dll`模块的基址，偏移计算为`0x6E5869C8-0x6DD20000=0x8669C8`。

在后续程序(C++)中只需要找到网易云音乐进程内`cloudmusic.dll`的模块的基址，然后加上偏移`0x8669C8`即是网易云音乐当前播放歌曲的实时进度，该进度是double类型，只需要读取8个字节，然后转化为double数据即可。

# 歌词获取方式
`C:\Users\[userName]\AppData\Local\Netease\CloudMusic\webdata\file\history`

上述文件是一个json数据格式，存放的是播放的历史记录，第一条即是最新播放的数据，根据该数据可以找到歌曲id
进而找到歌词所在

获取到歌曲id后使用网易云音乐api：
`https://music.163.com/api/song/lyric?id={歌曲id}&lv=1&kv=1&tv=-1`
获取即可

结合当前播放时间再转化一下可以获取当前播放的当前的一个歌词。

该方式的缺点是网易云音乐客户端在播放新的歌曲的时候不会立即刷新该文件，会有个2s~3s左右的延迟，暂时不知道怎么解决
            